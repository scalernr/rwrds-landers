<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test apps and get paid!</title>

  <!-- Your full CSS remains unchanged -->
  <style>
    /* [ All your original CSS as posted above â€” untouched ] */
    /* Keep your full CSS here â€” make sure it includes var(--brand-color) references */
  </style>

  <script src="../../../../../public/scripts/post_ttpixel.js"></script>
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1620194525592088');
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none" 
         src="https://www.facebook.com/tr?id=1620194525592088&ev=PageView&noscript=1"/>
  </noscript>
</head>

<body>
  <div id="particles-js" style="position:fixed;width:100%;height:100%;z-index:1"></div>

  <!-- Name alert popup -->
  <div id="nameAlert">
    <span style="font-size: 24px;">ðŸ’µ</span>
    <div><span class="name">Olivia M.</span> claimed $1000!</div>
  </div>

  <div class="page-container">
    <div class="reward-card">
      <div class="app-logo-container">
        <img alt="Test apps and get paid!" width="100" height="100" class="app-logo" src="../../../../../public/assets/prewardslogo3.png">
        <div class="cash-text">Test apps and get paid!</div>
        <img alt="Verified" width="80" height="80" class="verd-logo" src="../../../../../public/assets/verd.png">
      </div>
      <div id="amount" class="amount">$1000</div>
      <div class="amount-subtext">deposited to you</div>
      <div class="instructions-container">
        <div class="instruction-item">
          <span class="number">1</span>
          <span>Click the Button Below</span>
        </div>
        <div class="instruction-item">
          <span class="number">2</span>
          <span>Enter Your Email & Info</span>
        </div>
        <div class="instruction-item">
          <span class="number">3</span>
          <span class="underline">Complete Recommended Deals</span>
        </div>
        <div class="instruction-item">
          <span class="number">4</span>
          <span>Claim Reward & Repeat</span>
        </div>
      </div>
      <div class="button-container">
        <button id="claimButton" class="claim-button">Get Your $1000 â†’</button>
        <img alt="Trust Badge" class="trust-badge" src="../../../../../public/assets/trus2.png">
      </div>
    </div>
  </div>

  <!-- Load particles.js and initialize with dynamic brand color -->
  <script>
    function initParticles() {
      const brandColor = getComputedStyle(document.documentElement).getPropertyValue('--brand-color').trim() || '#FAC804';

      particlesJS('particles-js', {
        particles: {
          number: { value: 80, density: { enable: true, value_area: 800 } },
          color: { value: brandColor },
          shape: { type: 'circle' },
          opacity: { value: 0.5 },
          size: { value: 3, random: true },
          line_linked: {
            enable: true,
            distance: 150,
            color: brandColor,
            opacity: 0.4,
            width: 1
          },
          move: {
            enable: true,
            speed: 6,
            out_mode: 'out'
          }
        },
        interactivity: {
          detect_on: 'canvas',
          events: {
            onhover: { enable: true, mode: 'repulse' },
            onclick: { enable: true, mode: 'push' }
          }
        },
        retina_detect: true
      });
    }

    window.addEventListener('load', () => {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js';
      script.onload = initParticles;
      document.body.appendChild(script);
    });
  </script>

  <!-- Notification + Config Handler -->
  <script>
    const NAMES = ["Ava R.", "Ethan T.", "Luna W.", "Caleb R.", "Aria K.", "Julian P.", "Piper S.", "Gabriel L.", "Sofia G.", "Alexander T."];
    const notifications = [
      { icon: 'ðŸŽ‰', title: 'Recent Claims', text: '3 people claimed their reward in the last 5 minutes' },
      { icon: 'â°', title: 'Time Sensitive', text: 'Last chance to claim before cards run out' },
      { icon: 'ðŸ”¥', title: 'Trending Now', text: 'This offer is trending in your area' }
    ];

    function createNotification() {
      const notification = document.createElement('div');
      notification.className = 'notification';

      const isName = Math.random() > 0.5;
      if (isName) {
        const name = NAMES[Math.floor(Math.random() * NAMES.length)];
        notification.innerHTML = `
          <div class="notification-icon">ðŸ’µ</div>
          <div class="notification-content">
            <div class="notification-title">Recent Claim</div>
            <div class="notification-text"><span class="name">${name}</span> claimed $1000!</div>
          </div>`;
      } else {
        const note = notifications[Math.floor(Math.random() * notifications.length)];
        notification.innerHTML = `
          <div class="notification-icon">${note.icon}</div>
          <div class="notification-content">
            <div class="notification-title">${note.title}</div>
            <div class="notification-text">${note.text}</div>
          </div>`;
      }

      document.body.appendChild(notification);
      setTimeout(() => notification.classList.add('show'), 100);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    function startNotifications() {
      setTimeout(() => {
        createNotification();
        setInterval(() => {
          createNotification();
        }, Math.random() * 4000 + 8000);
      }, 3000);
    }

    function animateValue(el, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const value = Math.floor(progress * (end - start) + start);
        el.textContent = `$${value.toFixed(2)}`;
        if (progress < 1) requestAnimationFrame(step);
      };
      requestAnimationFrame(step);
    }

    window.addEventListener('load', () => {
      const amountEl = document.getElementById('amount');
      const amountVal = parseInt(amountEl.textContent.replace(/\D/g, '')) || 1000;
      animateValue(amountEl, 0, amountVal, 2000);
      startNotifications();
    });
  </script>

  <!-- Fetch Config from Cloudflare Pages Function -->
  <script>
    window.addEventListener('DOMContentLoaded', async () => {
      const res = await fetch('/config');
      const config = await res.json();

      const logo = document.querySelector('.app-logo');
      if (logo && config.logoPath) logo.src = config.logoPath;

      const headline = document.querySelector('.cash-text');
      if (headline && config.headline) headline.textContent = config.headline;

      const btn = document.getElementById('claimButton');
      if (btn && config.ctaText) btn.textContent = config.ctaText;

      if (config.brandColor) {
        document.documentElement.style.setProperty('--brand-color', config.brandColor);
      }

      if (btn && config.affiliateLink) {
        btn.addEventListener('click', () => {
          const params = new URLSearchParams(window.location.search);
          const subid = params.get('subid') || 'default';

          if (config.useExitTracking) {
            fetch('/exit', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                u: config.exit_u,
                p: config.exit_p,
                ttclid: params.get('ttclid'),
              }),
            });
          }

          const a = document.createElement('a');
          a.href = config.affiliateLink + encodeURIComponent(subid);
          a.rel = 'noreferrer';
          a.target = '_blank';
          a.click();
        });
      }
    });
  </script>
</body>
</html>